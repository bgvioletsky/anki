<!--
 * @Author: bgcode
 * @Date: 2025-07-18 19:12:22
 * @LastEditTime: 2025-07-19 19:08:22
 * @LastEditors: bgcode
 * @Description: 描述
 * @FilePath: /anki/a.html
 * 本项目采用GPL 许可证，欢迎任何人使用、修改和分发。
-->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anki 智能问答模板</title>
    <link rel="stylesheet" href="/index.css"></link>
   <style> 
       .options input[name="options"] {
        display: contents;
    }
        .options {
        list-style:upper-latin;
        
    }.option-item{
            display: flex;
            align-items: center;
            border: 1px solid #2bc8a0;
            border-radius: 1rem;
            height: 2rem;
            width: 2rem;
            justify-content: center;
            margin-right: 0.5rem;
    }
    li{
        display:flex;
        align-items: center;
    }
</style>

</head>

<body>
 <script>
if (!window.gData) {
    window.gData = {
        clickedValues: [],      // 用户选择的答案
        total: 0,               // 总题数
        correct: 0,             // 正确题数
        score: 0,               // 当前得分
        sum: 0,                 // 总分
        list: '',               // 选项列表HTML
        correctanswer: [],      // 正确答案（原始）
        rsltanswer: []          // 乱序后的正确答案
    };
}

const gData = window.gData;

// 初始化选项列表
function initOptions() {
    const optionList = document.getElementById("optionList");
    const classify = document.getElementById("classify");
    const options = document.getElementById("options");
    const answer = document.getElementById("answer");
    
    // 获取正确答案并判断题型
    const correctanswer = answer.innerText.toUpperCase().match(/[A-Fa-f]/g);
    gData.correctanswer = correctanswer;
    console.log(correctanswer);
    // 更新题型标签
    classify.innerText = correctanswer.length > 1 ? "多选题：" : "单选题：";
    
    // 处理选项文本
    let optionsText = options.innerHTML
    const optionsArray = optionsText.split(/##|<br>/g).filter(e => e.trim() !== "");  
    console.log(optionsArray);
    // 重置数据
    gData.rsltanswer = [];
    gData.clickedValues = [];
    
    // 创建选项列表
    optionsArray.forEach((option, index) => {
        const isCorrect = correctanswer.includes(String.fromCharCode(index + 65));
        const li = createOption(option, String.fromCharCode(index + 65), isCorrect);
        optionList.appendChild(li);
        
        if (isCorrect) {
            gData.rsltanswer.push(String.fromCharCode(index + 65));
        }
        console.log(li);
    });
    
    gData.list = optionList.innerHTML;
    gData.total++;
    
    // 添加事件委托
    optionList.addEventListener('click', handleOptionClick);
}

// 创建选项元素
function createOption(value, key, isCorrect) {
    const li = document.createElement("li");
    const input = document.createElement("input");
    const label = document.createElement("label");
    const p = document.createElement("div");
    // 设置input属性
    input.type = gData.correctanswer.length > 1 ? "checkbox" : "radio";
    input.name = "options";
    input.id = "input" + key;
    input.dataset.key = key;
    p.className = "option-item";
    p.textContent = key;
    // 设置label属性
    label.htmlFor = "input" + key;
    label.textContent = value;
    
    // 设置li属性
    li.className = isCorrect ? "optionTrue" : "optionFalse";
    li.dataset.key = key;
    
    // 组装元素
    li.appendChild(input);
      li.appendChild(p);
    li.appendChild(label);
    
    return li;
}

// 处理选项点击
function handleOptionClick(event) {
    const li = event.target.closest("li");
    if (!li) return;
    
    const key = li.dataset.key;
    const input = document.getElementById("input" + key);
    
    // 切换选中状态
    input.checked = !input.checked;
    
    // 更新选中样式
    updateOptionStyle(li, input.checked);
    
    // 更新用户选择
    updateClickedValues(key, input.type, input.checked);
}

// 更新选项样式
function updateOptionStyle(element, isChecked) {
    if (isChecked) {
        element.classList.add("selected");
    } else {
        element.classList.remove("selected");
    }
}

// 更新用户选择数据
function updateClickedValues(key, inputType, isChecked) {
    if (inputType === "checkbox") {
        if (isChecked) {
            gData.clickedValues.push(key);
        } else {
            const index = gData.clickedValues.indexOf(key);
            if (index !== -1) {
                gData.clickedValues.splice(index, 1);
            }
        }
    } else {
        // 单选模式重置其他选项
        gData.clickedValues = [key];
        document.querySelectorAll('input[name="options"]').forEach(input => {
            if (input.id !== "input" + key) {
                input.checked = false;
                const li = input.closest("li");
                if (li) li.classList.remove("selected");
            }
        });
    }
}

// 检查答案
function checkAnswer() {
    const isCorrect = arraysMatch(gData.clickedValues.sort(), gData.rsltanswer.sort());
    
    if (isCorrect) {
        gData.correct++;
        gData.score += 10; // 每题10分
        showResult(true);
    } else {
        showResult(false);
    }
    
    // 更新总分
    gData.sum = gData.total * 10;
    
    // 禁用选项点击
    document.getElementById("optionList").removeEventListener('click', handleOptionClick);
}

// 比较两个数组是否相同
function arraysMatch(arr1, arr2) {
    if (arr1.length !== arr2.length) return false;
    return arr1.every((val, index) => val === arr2[index]);
}

// 显示结果反馈
function showResult(isCorrect) {
    const resultContainer = document.getElementById("resultContainer");
    resultContainer.innerHTML = isCorrect 
        ? '<div class="correct">回答正确！</div>' 
        : `<div class="wrong">回答错误！正确答案是：${gData.rsltanswer.join(', ')}</div>`;
    
    // 高亮正确选项
    document.querySelectorAll("li.optionTrue").forEach(li => {
        li.classList.add("correct-answer");
    });
}

</script>


<div class="container">
    <div class="timu"><div id="classify" class="classify">单选题：</div>a</div>
		<ol id="optionList" class="options"></ol>
		<div id="options" style="display:none">萨达省<br>圣诞<br>大师<br>我爱的<br>打</div>
		<div id="answer" style="display:none">abC</div>
		<div id="checkAns" ></div>
    <div class="deck-info">{{Deck}}</div>
    <div class="countdown-container">
        <div class="countdown-text">考试倒计时</div>
        <div id="countDown" class="countdown-digits">
        </div>   
</div>
<script>
	initOptions();
</script>

</body>

</html>