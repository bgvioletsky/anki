<!--
 * @Author: bgcode
 * @Date: 2025-07-19 18:02:53
 * @LastEditTime: 2025-07-19 18:21:52
 * @LastEditors: bgcode
 * @Description: 描述
 * @FilePath: /anki/a1.html
 * 本项目采用GPL 许可证，欢迎任何人使用、修改和分发。
-->
<div class="deck-info">{{Deck}}</div>
<div class="countdown-container">
    <div class="countdown-text">考试倒计时</div>
    <div id="countDown" class="countdown-digits"></div>
</div>
<div class="container">
    <div id="classify" class="classify">单选题</div>
    <div class="timu">{{问题}}</div>
    <ol id="optionList" class="options"></ol>
    <div id="options" style="display:none">{{选项}}</div>
    <div id="answer" style="display:none">{{答案}}</div>
</div>

<script>
    if (!window.gData) {
        window.gData = {
            clickedValues: [],      // 用户选择的答案
            total: 0,               // 总题数
            correct: 0,             // 正确题数
            score: 0,               // 当前得分
            sum: 0,                 // 总分
            list: '',               // 选项列表HTML
            correctanswer: [],      // 正确答案（原始）
            rsltanswer: []          // 乱序后的正确答案
        };
    }

    const gData = window.gData;

    function initOptions() {
        const optionList = document.getElementById("optionList");
        const classify = document.getElementById("classify");
        const options = document.getElementById("options");
        const answer = document.getElementById("answer");
        const correctanswer = answer.innerText.toUpperCase().match(/[A-Fa-f]/g);
        gData.correctanswer = correctanswer;
        // 更新题型标签
        classify.innerText = correctanswer.length > 1 ? "多选题：" : "单选题：";
        let optionsText = options.innerHTML
        const optionsArray = optionsText.split(/<br>/g).filter(e => e.trim() !== "");
        gData.rsltanswer = [];
        gData.clickedValues = [];
        // 创建选项列表
        optionsArray.forEach((option, index) => {
            const isCorrect = correctanswer.includes(String.fromCharCode(index + 65));
            const li = createOptionElement(option, String.fromCharCode(index + 65), isCorrect);
            optionList.appendChild(li);

            if (isCorrect) {
                gData.rsltanswer.push(String.fromCharCode(index + 65));
            }
        });

        gData.list = optionList.innerHTML;
        gData.total++;

        // 添加事件委托
        optionList.addEventListener('click', handleOptionClick);
    }

    function createOptionElement(value, key, isCorrect) {
        const li = document.createElement("li");
        const input = document.createElement("input");
        const label = document.createElement("label");

        // 设置input属性
        input.type = gData.correctanswer.length > 1 ? "checkbox" : "radio";
        input.name = "options";
        input.id = "input" + key;
        input.dataset.key = key;

        // 设置label属性
        label.htmlFor = "input" + key;
        label.textContent = value;

        // 设置li属性
        li.className = isCorrect ? "optionTrue" : "optionFalse";
        li.dataset.key = key;

        // 组装元素
        li.appendChild(input);
        li.appendChild(label);

        return li;
    }